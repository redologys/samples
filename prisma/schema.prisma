// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// ============================================
// AUTHENTICATION MODELS
// ============================================

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String?   @unique
  emailVerified DateTime?
  phone         String?   @unique
  image         String?
  password      String?
  role          String    @default("CUSTOMER") // SQLite doesn't support enums
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  accounts  Account[]
  sessions  Session[]
  bookings  Booking[]
  devices   Device[]
  orders    Order[]
  reviews   Review[]
}

// ============================================
// BOOKING & REPAIR MODELS
// ============================================

model Device {
  id        String   @id @default(cuid())
  userId    String?
  brand     String
  model     String
  color     String?
  imei      String?
  notes     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user     User?     @relation(fields: [userId], references: [id])
  bookings Booking[]
}

model Booking {
  id              String        @id @default(cuid())
  bookingNumber   String        @unique @default(cuid())
  userId          String?
  deviceId        String?
  
  // Customer Info
  customerName    String
  customerPhone   String
  customerEmail   String
  
  // Device Info
  deviceType      String // SQLite doesn't support enums
  deviceBrand     String
  deviceModel     String
  
  // Issue Info
  issueType       String // SQLite doesn't support enums
  issueDescription String?
  
  // Scheduling
  appointmentDate DateTime
  appointmentTime String
  estimatedTime   String?
  
  // Pricing
  estimatedPrice  Decimal?
  finalPrice      Decimal?
  
  // Status
  status          String @default("PENDING") // SQLite doesn't support enums
  
  // Photos - simplified for SQLite (JSON string or separate table is better usually, but simplified here)
  photos          String? 
  
  // Tracking
  trackingCode    String        @unique @default(cuid())
  
  // Timestamps
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  completedAt     DateTime?
  
  user            User?         @relation(fields: [userId], references: [id])
  device          Device?       @relation(fields: [deviceId], references: [id])
  statusHistory   StatusUpdate[]
  notifications   Notification[]
}

model StatusUpdate {
  id          String   @id @default(cuid())
  bookingId   String
  status      String   // SQLite doesn't support enums
  message     String?
  technicianId String?
  createdAt   DateTime @default(now())

  booking     Booking  @relation(fields: [bookingId], references: [id])
}

model Notification {
  id          String           @id @default(cuid())
  bookingId   String
  type        String           // SQLite doesn't support enums
  channel     String           // SQLite doesn't support enums
  recipient   String
  message     String
  status      String           @default("PENDING") // SQLite doesn't support enums
  sentAt      DateTime?
  createdAt   DateTime         @default(now())

  booking     Booking          @relation(fields: [bookingId], references: [id])
}

// ============================================
// SERVICES & PRICING
// ============================================

model Service {
  id            String   @id @default(cuid())
  name          String
  description   String
  category      String   // SQLite doesn't support enums
  basePrice     Decimal
  estimatedTime String
  warranty      String
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  devicePricing DeviceServicePricing[]
}

model DeviceServicePricing {
  id          String   @id @default(cuid())
  serviceId   String
  deviceBrand String
  deviceModel String
  price       Decimal
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  service     Service  @relation(fields: [serviceId], references: [id])

  @@unique([serviceId, deviceBrand, deviceModel])
}

// ============================================
// PRODUCTS & E-COMMERCE
// ============================================

model Product {
  id            String          @id @default(cuid())
  name          String
  slug          String          @unique
  description   String
  category      String          // SQLite doesn't support enums
  brand         String?
  compatibleWith String?        // SQLite doesn't support string arrays natively well, using String for simple join or JSON
  price         Decimal
  comparePrice  Decimal?
  images        String?         // SQLite doesn't support string arrays
  stock         Int             @default(0)
  isActive      Boolean         @default(true)
  isFeatured    Boolean         @default(false)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  orderItems    OrderItem[]
  cartItems     CartItem[]
}

model Cart {
  id        String     @id @default(cuid())
  sessionId String     @unique
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  items     CartItem[]
}

model CartItem {
  id        String   @id @default(cuid())
  cartId    String
  productId String
  quantity  Int      @default(1)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  cart      Cart     @relation(fields: [cartId], references: [id], onDelete: Cascade)
  product   Product  @relation(fields: [productId], references: [id])

  @@unique([cartId, productId])
}

model Order {
  id              String      @id @default(cuid())
  orderNumber     String      @unique
  userId          String?
  
  // Customer Info
  customerName    String
  customerEmail   String
  customerPhone   String
  
  // Payment
  subtotal        Decimal
  tax             Decimal
  total           Decimal
  stripePaymentId String?
  paymentStatus   String      @default("PENDING") // SQLite doesn't support enums
  
  // Status
  status          String      @default("PENDING") // SQLite doesn't support enums
  
  // Timestamps
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  user            User?       @relation(fields: [userId], references: [id])
  items           OrderItem[]
}

model OrderItem {
  id        String   @id @default(cuid())
  orderId   String
  productId String
  name      String
  price     Decimal
  quantity  Int
  createdAt DateTime @default(now())

  order     Order    @relation(fields: [orderId], references: [id])
  product   Product  @relation(fields: [productId], references: [id])
}

// ============================================
// BILL PAYMENT
// ============================================

model BillPayment {
  id              String      @id @default(cuid())
  paymentNumber   String      @unique
  
  // Customer Info
  customerName    String
  customerEmail   String
  customerPhone   String
  
  // Payment Details
  carrier         String      // SQLite doesn't support enums
  phoneNumber     String
  amount          Decimal
  fee             Decimal     @default(0)
  total           Decimal
  
  stripePaymentId String?
  status          String      @default("PENDING") // SQLite doesn't support enums
  
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
}

// ============================================
// REVIEWS & TESTIMONIALS
// ============================================

model Review {
  id          String   @id @default(cuid())
  userId      String?
  customerName String
  rating      Int
  comment     String
  source      String   @default("website")
  isApproved  Boolean  @default(false)
  isFeatured  Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user        User?    @relation(fields: [userId], references: [id])
}

// ============================================
// TIME SLOTS & AVAILABILITY
// ============================================

model TimeSlot {
  id          String   @id @default(cuid())
  date        DateTime
  time        String
  isAvailable Boolean  @default(true)
  maxBookings Int      @default(2)
  currentBookings Int  @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([date, time])
}

// ============================================
// BUSINESS SETTINGS
// ============================================

model BusinessHours {
  id        String   @id @default(cuid())
  dayOfWeek Int
  openTime  String
  closeTime String
  isClosed  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([dayOfWeek])
}

model BusinessSettings {
  id                String   @id @default(cuid())
  businessName      String
  address           String
  city              String
  state             String
  zipCode           String
  phone             String
  email             String
  website           String?
  googleMapsUrl     String?
  googlePlaceId     String?
  googleRating      Decimal?
  googleReviewCount Int?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}
